---
title: "Reproducible Research: Peer Assessment 1"
date: "`r Sys.Date()`" 
author: Dr. M. Teunis
output: 
  html_document:
    keep_md: true
---

```{r, rprojroot}
# Project root
# Package {rprojroot} handles issues with the root in 
# knitting Rmd files.
## install.packages("rprojroot")
library(rprojroot)
```

```{r, knitr_setup}
# Knitr options and defining the root of the project
knitr::opts_chunk$set(echo = TRUE)
ROOT <- find_root_file(criterion = is_rstudio_project)
knitr::opts_knit$set(root.dir = ROOT)
```

```{r, packages, message=FALSE, warning=FALSE}
## install.packages("dplyr", dependencies = TRUE)
## install.packages("readr")
## install.packages("ggplot2")
## install.packages("pander")
## install.packages("lubridate")

library(dplyr)
library(readr)
library(ggplot2)
library(pander)
library(lubridate)

```

## Loading and preprocessing the data

### Unzipping the activity.zip file
```{r, unzip_data}

data_file <- paste0(ROOT, "/activity.zip") 
unzip(zipfile = data_file, exdir = "./data" )
``` 

### Reading the datafile
For reading, cleaning and subsetting the data I use the 'Hadley' verse packages: {readr}, {dplyr}.
The {lubridate} package handles time-formats in data
```{r, reading_data}
activity <- read_csv(file = "./data/activity.csv")
``` 

### Inspecting the activity dataframe
```{r, inspect_data}
head(activity)
glimpse(activity)
str(activity)
```

## changing $date type to date with lubridate
``` {r}
activity$date <- ymd(activity$date)
str(activity)
``` 

### Removing NAs
```{r, na_omit}
activity_na_omit <- na.omit(activity)
str(activity_na_omit)
```

## What is mean total number of steps taken per day?
For this part of the assignment the missing values can be ignored.

 1) Calculate the total number of steps taken per day.
 
 2) Make a histogram of the total number of steps taken each day.
 
 3) Calculate and report the mean and median of the total number of steps taken per day.

### Ad 1. Total number of steps taken per day
Converting $date to character, than to factor
Subsetting and calculating steps per day, using the pipe (%>%) operator. 
```{r}
library(dplyr)
tot_steps_pd <- activity_na_omit %>%
            group_by(date) %>% 
            summarise(total_steps = sum(steps))

head(tot_steps_pd, 10)    
```

### Ad 2. Plotting total steps per day
```{r, fig.height=4, fig.width=12}
library(ggplot2)
# function to save ggplot2 plots
# this function takes the argument imageDirectory and filename as arguments

# creating image directory
dir.create(paste0(ROOT, "/images"))

imageDirectory <- paste0(ROOT, "./images")
saveInImageDirectory<-function(imageDirectory,filename){
  imageFile <- file.path(imageDirectory, filename)
  ggsave(imageFile, dpi = 300, width = 8, height = 6)	
}

# plotting total steps per day
p <- ggplot(data = tot_steps_pd, aes(x = total_steps))
graph <- p + geom_histogram(binwidth = 1000) +
  theme(plot.margin = unit(c(1,1,1,1), "cm")) +
      theme(axis.text.x = element_text(size=11)) +
            labs(title = "Total steps per day") +
                  xlab("Steps per Day") + 
                  ylab("Frequency")

graph
``` 

```{r}
## saving the graph in "./images"
saveInImageDirectory(imageDirectory = imageDirectory,
filename = "mean_steps_per_day.png")
```

### Calculating and report mean and median of total number of steps per day
```{r}


activity$steps <- as.numeric(activity$steps)
activity$interval <- as.numeric(activity$interval)

mean_median_steps_pd <- activity %>%
            group_by(date) %>% 
            summarise(mean_steps = mean(steps), 
                      median_steps = median(steps))

overall_mean <- mean(mean_median_steps_pd$mean_steps)
overall_median <- mean(mean_median_steps_pd$median_steps)

pander(cbind(overall_mean, overall_median))

```


## What is the average daily activity pattern?

 1) Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r}
library(dplyr)
## install.packages("astsa")  # install it ... I'm using version 1.5 below
library(astsa)             # then load it (has to be done at the start of each session)
install.packages("stats")


timeSeries <- ts(data = activity, start = c(2012,10,2), 
                 end = c(2012,11,29), frequency = ((24*60)/5))

timeSeries


ts(data = NA, start = 1, end = numeric(), frequency = 1,
   deltat = 1, ts.eps = getOption("ts.eps"), class = , names = )
as.ts(x, ...)
is.ts(x)

str(activity)
activity$steps <- as.numeric(activity$steps)





time_series <- 
```











 2) Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?




## Imputing missing values



## Are there differences in activity patterns between weekdays and weekends?
